@using System.Data.SqlTypes
@using PiF
@using PiF.Models
@model IEnumerable<Thread>

    @Scripts.Render("~/bundles/index")
@{ ViewBag.Title = User.Identity.Name; }

@section featured {
    <section class="featured">
        <div class="content-wrapper">
            <hgroup class="title">
                <h2>@ViewBag.Title</h2>
            </hgroup>
            <div class="games-given">Given @AccountHelper.CurrentUser.GivenCount</div><div class="games-received">Received @AccountHelper.CurrentUser.ReceivedCount</div>
        </div>
    </section>
}
<p>
    @Html.ActionLink("Create New", "New", "PiF")
</p>

<div class="giveaways">
    <h2>Open giveaways</h2>
    <ol>
         @foreach (var item in Model)
    {
             if (item.EndDate == SqlDateTime.MinValue)
              {
                  <li class="pif">
                      <a href="@item.ThreadGames.First().Game.StoreUrl"><img src="@item.ThreadGames.First().Game.ImageUrl" alt="@item.ThreadGames.First().Game.Name"/></a>
                      <h3><a href="@string.Format("http://redd.it/{0}", item.ThingID)">@item.Title</a><span class="pifscore">1</span></h3>
                      <div class="createdTime">Created <strong>@Html.TimeAgo(@item.CreatedDate)</strong>
                      </div>
                  </li>
              }
    }
             </ol>

</div>
<div class="giveaways">
    <h2>Closed Giveaways</h2>
    <ol>
        @foreach( var item in Model)
        {
            if (item.EndDate != SqlDateTime.MinValue)
            {
                  <li class="pif">
                      <a href="@item.ThreadGames.First().Game.StoreUrl"><img src="@item.ThreadGames.First().Game.ImageUrl" alt="@item.ThreadGames.First().Game.Name"/></a>
                      <h3><a href="@string.Format("http://redd.it/{0}", item.ThingID)">@item.Title</a><span class="pifscore">1</span></h3>
                      <div class="createdTime">Created: <strong>@Html.TimeAgo(@item.CreatedDate)</strong>
                      <text> - Closed: <strong>@Html.TimeAgo(@item.CreatedDate)</strong></text>
                      </div>
                  </li>
            }
        }
    </ol>    
</div>

<!--
<table>
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Title)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.CreatedDate)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.EndDate)
        </th>
        <th>@Html.DisplayNameFor(model => model.ThingID)</th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Title)
            </td>
            <td>
                @item.CreatedDate.ToString("d")
            </td>
            <td>
                @if (item.EndDate == SqlDateTime.MinValue)
                {
                    <text>Not completed</text>
                }
                else
                {
                    @Html.DisplayFor(modelItem => item.EndDate)
                }
            </td>
            <td>
                <a href="@string.Format("http://redd.it/{0}", item.ThingID)">@string.Format("http://redd.it/{0}", item.ThingID)</a>
            </td>
            <td>
                @{ bool canEdit = item.ThreadGames.Any(tg => tg.WinnerID == null); }
                
                @if (canEdit)
                {
                    @Html.ActionLink("Edit", "Edit", "PiF", new { item.ThingID }, null)
                    <text> | @Html.ActionLink("Complete", "Complete", "PiF", new { item.ThingID }, null)</text>
                }
                else
                {
                    @Html.ActionLink("View", "View", "PiF", new { item.ThingID }, null)
                }
            </td>
        </tr>
    }
</table>
-->